<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Sindical - Vendas Caravana</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <link rel="shortcut icon" href="#{facesContext.externalContext.requestContextPath}/Imagens/favicon.ico"/>  
        <style type="text/css">
            .ui-widget-content .ui-inputfield{ padding: 8px!important;} 
            .ui-button { padding: 3px!important; }
            .ui-selectonemenu-label .ui-inputfield{

            }
        </style>   
    </h:head>
    <h:body>
        <!-- INICIA DIV wrap e main -->
        <div id="wrapx">
            <div id="mainx">
                <!-- INICIA DIV wrap e main -->  
                <f:subview id="header">
                    <ui:include src="templates/templatePrime.xhtml"/>
                </f:subview>
                <f:view>
                    <h:form id="formVendasCaravana">
                        <p:growl id="i_msg" showDetail="true" />  
                        <p:panel style="margin: 0 auto; border: 0; width: #{configuracaoBean.resolucao.tipoResolucao.tamanho}">
                            <h:outputText value="Vendas Caravana" styleClass="fonteHeader" />

                            <p:panel styleClass="fundoCinza" style="clear: both">
                                <h:panelGrid id="i_panel_pessoa" columns="6">
                                    <p:commandButton ajax="false" value="Adicionar Pessoa" action="#{chamadaPaginaBean.pesquisaPessoa()}" rendered="#{vendasCaravanaBean.pessoa.id == -1}"/>
                                    <p:outputLabel value="Responsável: " rendered="#{vendasCaravanaBean.pessoa.id != -1}" style="font-size: 11pt!important;"/>
                                    <p:outputLabel value="#{vendasCaravanaBean.pessoa.nome}" rendered="#{vendasCaravanaBean.pessoa.id != -1}" style="font-size: 12pt!important; font-weight: bold"/>
                                    <p:commandButton icon="ui-icon-trash" action="#{vendasCaravanaBean.removerPessoa}" update="i_panel_pessoa" rendered="#{vendasCaravanaBean.pessoa.id != -1} " style="width: 25px; height: 25px"/>
                                    <h:panelGrid rendered="#{vendasCaravanaBean.pessoaEndereco.id == -1 and vendasCaravanaBean.pessoa.id != -1}">
                                        <h:outputLabel value="Esta pessoa não possui endereço" style="font-size: 9pt!important; color: red" />
                                        <p:commandLink value="clique aqui para adicionar" action="#{vendasCaravanaBean.cadastroFisica()}" rendered="#{vendasCaravanaBean.pessoaFisica.id != -1}" style="font-size: 9pt!important; color: blue" />
                                        <p:commandLink value="clique aqui para adicionar" action="#{vendasCaravanaBean.cadastroJuridica()}" rendered="#{vendasCaravanaBean.pessoaJuridica.id != -1}" style="font-size: 9pt!important; color: blue" />
                                    </h:panelGrid> 
                                    <h:panelGrid rendered="#{vendasCaravanaBean.pessoaEndereco.id != -1 and vendasCaravanaBean.pessoa.id != -1}">
                                        <p:commandButton ajax="false" icon="ui-icon-home" title="Editar Endereço" action="#{vendasCaravanaBean.cadastroFisica()}" rendered="#{vendasCaravanaBean.pessoaFisica.id != -1}" style="width: 25px; height: 25px"/>
                                        <p:commandButton ajax="false" icon="ui-icon-home" title="Editar Endereço" action="#{vendasCaravanaBean.cadastroJuridica()}" rendered="#{vendasCaravanaBean.pessoaJuridica.id != -1}" style="width: 25px; height: 25px"/>
                                    </h:panelGrid> 
                                    <c:if test="#{vendasCaravanaBean.pessoa.id != -1}">
                                        <p:commandButton value="Alterar dia vencimento" onclick="PF('dgl_alterar_dia_vencto').show();" update="i_alterar_dia_vencto"  />
                                    </c:if>
                                </h:panelGrid>
                                <h:panelGrid id="i_caravanas" columns="4">
                                    <h:column>
                                        <h:outputLabel value="Caravana" /><br />
                                        <p:selectOneMenu value="#{vendasCaravanaBean.idCaravana}" style="width: 500px; padding-right: 20px" disabled="#{vendasCaravanaBean.listaReservas.size() != 0}">
                                            <p:ajax event="change" listener="#{vendasCaravanaBean.atualizaCaravana()}" update="i_panel i_caravanas"/>
                                            <f:selectItems value="#{vendasCaravanaBean.listaCaravanaSelect}" />
                                        </p:selectOneMenu>
                                    </h:column>
                                    <h:column>
                                        <h:outputLabel value="N° Quarto" style="margin-left: 30px" /><br />
                                        <p:inputText size="5" value="#{vendasCaravanaBean.vendas.quartoString}" style="margin-left: 30px" converter="#{thisNumber}">
                                            <p:ajax event="change" update="@this" />
                                        </p:inputText>
                                    </h:column>
                                    <h:column>
                                        <h:outputLabel value="Tipo" style="margin-left: 30px"/><br />
                                        <p:selectOneMenu value="#{vendasCaravanaBean.idTipo}" style="margin-left: 30px; padding-right: 20px" disabled="#{vendasCaravanaBean.vendas.id != -1}">
                                            <p:ajax event="change" listener="#{vendasCaravanaBean.atualizaTipo()}" update="i_panel"/>
                                            <f:selectItems value="#{vendasCaravanaBean.listaTipo}"/>
                                        </p:selectOneMenu>
                                    </h:column>                                    
                                    <h:column>
                                        <br />
                                        <p:commandButton value="Adicionar" style="margin-left: 30px" action="#{vendasCaravanaBean.adicionarReserva()}" disabled="#{vendasCaravanaBean.vendas.id != -1}" update="i_msg i_servicos i_caravanas"/>
                                    </h:column>
                                </h:panelGrid>
                            </p:panel>
                            <br />
                            <h:panelGrid id="i_panel" columns="9">
                                <h:column>
                                    <h:outputLabel value="Data Saída" /><br /><br />
                                    <h:outputLabel value="#{vendasCaravanaBean.caravana.dataSaida}" style="font-weight: bold; font-size: 14pt"/>
                                </h:column>
                                <h:column>
                                    <h:outputLabel value="Horário" style="margin-left: 30px"/><br /><br />
                                    <h:outputLabel value="#{vendasCaravanaBean.caravana.horaSaida}" style="font-weight: bold; font-size: 14pt; margin-left: 30px"/>
                                </h:column>
                                <h:column>
                                    <hr style="height: 15px; margin-left: 30px" />
                                </h:column>
                                <h:column>
                                    <h:outputLabel value="Data Retorno" style="margin-left: 30px" /><br /><br />
                                    <h:outputLabel value="#{vendasCaravanaBean.caravana.dataRetorno}" style="font-weight: bold; font-size: 14pt; margin-left: 30px"/>
                                </h:column>
                                <h:column>
                                    <h:outputLabel value="Horário" style="margin-left: 30px"/><br /><br />
                                    <h:outputLabel value="#{vendasCaravanaBean.caravana.horaRetorno}" style="font-weight: bold; font-size: 14pt; margin-left: 30px"/>
                                </h:column>
                                <h:column>
                                    <hr style="height: 15px; margin-left: 30px" />
                                </h:column>
                                <h:column>
                                    <h:outputLabel value="Data Chegada" style="margin-left: 30px" /><br /><br />
                                    <h:outputLabel value="#{vendasCaravanaBean.caravana.dataChegada}" style="font-weight: bold; font-size: 14pt; margin-left: 30px"/>
                                </h:column>
                                <h:column>
                                    <h:outputLabel value="Horário" style="margin-left: 30px"/><br /><br />
                                    <h:outputLabel value="#{vendasCaravanaBean.caravana.horaChegada}" style="font-weight: bold; font-size: 14pt; margin-left: 30px"/>
                                </h:column>
                                <h:column>
                                    <h:selectBooleanCheckbox id="i_cafe" style="margin-left: 30px" value="#{vendasCaravanaBean.caravana.isCafe}" disabled="true"/>
                                    <h:outputLabel for="i_cafe" value=" Café " />
                                    <h:selectBooleanCheckbox id="i_almoco" style="margin-left: 30px" value="#{vendasCaravanaBean.caravana.isAlmoco}" disabled="true"/>
                                    <h:outputLabel for="i_almoco" value=" Almoço " />
                                    <h:selectBooleanCheckbox id="i_jantar" style="margin-left: 30px" value="#{vendasCaravanaBean.caravana.isJantar}" disabled="true"/>
                                    <h:outputLabel for="i_jantar" value=" Jantar " />
                                </h:column>
                            </h:panelGrid>
                            <hr />
                            <br />
                            <h:panelGrid style="width: 100%">
                                <h:outputLabel value="Observações" />
                                <p:inputTextarea value="#{vendasCaravanaBean.vendas.observacao}" rows="1" maxlength="255" style="width: 100%"/>
                            </h:panelGrid>
                            <br />
                            <p:dataTable id="i_servicos" var="listaReservas" style="width:100%;" value="#{vendasCaravanaBean.listaReservas}" rowIndexVar="it" emptyMessage="Nenhum serviço foi adicionado!">
                                <p:column style="width: 30px">
                                    <p:commandButton icon="ui-icon-trash" title="Excluir Serviço" action="#{vendasCaravanaBean.removerReserva(it, listaReservas)}" update="i_servicos :formVendasCaravana:i_valores :formVendasCaravana:i_caravanas" disabled="#{vendasCaravanaBean.vendas.id != -1}"/>
                                </p:column>
                                <p:column headerText="Passageiro">
                                    <p:commandButton ajax="false" icon="ui-icon-search" action="#{vendasCaravanaBean.pesquisaPassageiro(it)}" disabled="#{vendasCaravanaBean.vendas.id != -1}"/>
                                    <h:outputLabel value="#{listaReservas.fisica.pessoa.nome}" style="margin-left: 10px "/>
                                </p:column>

                                <p:column headerText="Poltrona" style="text-align: center; width: 60px" >
                                    <p:selectOneMenu value="#{listaReservas.poltrona}" style="padding-right: 20px" rendered="#{vendasCaravanaBean.vendas.id == -1}">
                                        <f:selectItems value="#{vendasCaravanaBean.listaPoltrona}" />
                                    </p:selectOneMenu>                                    
                                    <h:outputLabel value="#{listaReservas.reservas.poltrona}" style="margin-left: 10px; font-weight: bold; font-size: 12pt!important" rendered="#{vendasCaravanaBean.vendas.id != -1}"/>
                                </p:column>

                                <p:column headerText="Valor (R$)" style="text-align: center; width: 100px">
                                    <h:outputText value="#{listaReservas.valor}" style="font-weight: bold"/>
                                </p:column>

                                <p:column headerText="Desconto (R$)" style="text-align: center; width: 100px">
                                    <h:column>
                                        <p:inputText value="#{listaReservas.desconto}" rendered="#{vendasCaravanaBean.vendas.id == -1}" converter="#{toCurrency}" styleClass="text-right" size="8">
                                            <p:ajax event="change" listener="#{vendasCaravanaBean.atualizaValoresGrid(it)}" update="@this :formVendasCaravana:i_valores"/>
                                        </p:inputText>
                                        <h:outputText value="#{listaReservas.desconto}" style="font-weight: bold" rendered="#{vendasCaravanaBean.vendas.id != -1}"/>                                                                                    
                                    </h:column>
                                </p:column>
                                <p:column headerText="Tipo">
                                    <h:outputLabel value="#{listaReservas.reservas.eventoServico.descricao}" />
                                </p:column>
                            </p:dataTable>
                            <p:panel id="i_valores" styleClass="fundoCinza" style="clear: both; margin-top: 10px" header="Financeiro">
                                <h:panelGrid columns="7" cellspacing="3">
                                    <h:column>
                                        <h:panelGrid>
                                        <h:outputLabel value="Valor Total (R$)" />
                                        <p:inputText value="#{vendasCaravanaBean.valorTotal}" readonly="true" styleClass="bold text-right" size="10" />
                                        </h:panelGrid>
                                    </h:column>
                                    <h:column>
                                        <h:panelGrid>
                                        <h:outputLabel value="Valor Pago (R$)" />
                                        <p:inputText value="#{vendasCaravanaBean.valorPago}" readonly="true" styleClass="bold text-right" size="10" />
                                        </h:panelGrid>
                                    </h:column>
                                    <h:column>
                                        <h:panelGrid>
                                            <h:outputLabel value="Outras Parcelas" />
                                            <p:inputText value="R$ #{vendasCaravanaBean.valorOutras}" readonly="true" styleClass="bold text-right" size="10" />
                                        </h:panelGrid>
                                    </h:column>
                                    <h:column>
                                        <h:panelGrid>
                                        <h:outputLabel value="Parcelas" />
                                        <p:inputText value="#{vendasCaravanaBean.parcelasString}" size="3" maxlength="2" converter="#{thisNumber}" styleClass="text-center">
                                            <p:ajax event="change" update="@this" />
                                        </p:inputText>
                                        </h:panelGrid>
                                    </h:column>
                                    <h:column>
                                        <h:panelGrid>
                                        <h:outputLabel value="Data Entrada"/>
                                        <p:inputMask value="#{vendasCaravanaBean.dataEntrada}" mask="99/99/9999" size="8" converter="#{isDateString}" styleClass="text-center">
                                            <p:ajax event="change" update="@this" />
                                        </p:inputMask>
                                        </h:panelGrid>
                                    </h:column>
                                    <h:column>
                                        <h:panelGrid>
                                        <h:outputLabel value="Valor Entrada (R$)" />
                                        <p:inputText value="#{vendasCaravanaBean.valorEntrada}" converter="#{toCurrency}" styleClass="text-right">
                                            <p:ajax event="change" update="@this i_parcelas formVendasCaravana:i_panel_concluir_reserva" listener="#{vendasCaravanaBean.listaDataEntrada.clear()}"/>
                                        </p:inputText>
                                        </h:panelGrid>
                                    </h:column>
                                    <h:column>
                                        <br />
                                        <p:commandButton value="Gerar" action="#{vendasCaravanaBean.gerarParcelas}" disabled="#{vendasCaravanaBean.vendas.id != -1}" style="margin-left: 30px" update="i_parcelas formVendasCaravana:i_panel_concluir_reserva formVendasCaravana:i_actions :formVendasCaravana:i_message" />
                                    </h:column>      
                                </h:panelGrid>
                            </p:panel>
                            <p:messages autoUpdate="false" closable="false" showDetail="true" showSummary="true" id="i_message"/>
                            <p:dataTable id="i_parcelas" value="#{vendasCaravanaBean.listaParcelas}" var="parcelas" style="width:100%" emptyMessage="Nenhuma Parcela Adicionada" rowIndexVar="index">
                                <p:column headerText="Vencimento" styleClass="text-center">
                                    <p:inputMask value="#{parcelas.vencimento}" readonly="#{controleAcessoBean.permissaoValida('alterar_vencimento_vendas_caravana', 3) or vendasCaravanaBean.vendas.id != -1}" mask="99/99/9999" converter="#{isDateString}" size="8" styleClass="text-center" title="Alterar Vencimento Vendas Caravana" >
                                        <p:ajax event="change" update="@this" global="false"/>
                                    </p:inputMask>
                                </p:column>
                                <p:column headerText="Valor da Parcela" styleClass="text-center">
                                    <h:outputLabel value="R$ "/>
                                    <p:inputText value="#{parcelas.valor}" style="text-align: right; width: 80px; color: #{(not empty vendasCaravanaBean.valorEntrada and vendasCaravanaBean.valorEntrada eq parcelas.valor and index eq 0) ? 'blue; font-weight: bold;' : 'black'}" converter="#{toCurrency}" readonly="#{(not empty vendasCaravanaBean.valorEntrada and vendasCaravanaBean.valorEntrada eq parcelas.valor and index eq 0) or vendasCaravanaBean.vendas.id != -1}">
                                        <p:ajax event="change" listener="#{vendasCaravanaBean.atualizaValoresParcela(index)}" update="@this, :formVendasCaravana:i_message :formVendasCaravana:i_actions"/>
                                    </p:inputText>
                                </p:column>
                                <p:column headerText="Status" styleClass="text-center">
                                    <h:outputLabel value="· #{parcelas.baixado ? 'PAGO' : 'NÃO PAGO'} ·" style="color:#{parcelas.baixado ? 'blue' : 'red'}; font-weight: bold" />
                                </p:column>
                            </p:dataTable>
                            <h:panelGrid columns="5" id="i_actions">
                                <p:commandButton value="Concluir Reserva" title="Gravar Reserva" onclick="PF('i_dlg_s').show()" disabled="#{vendasCaravanaBean.disabledSave or vendasCaravanaBean.vendas.id != -1}"/>
                                <p:commandButton ajax="false" value="Novo" title="Novo" action="#{vendasCaravanaBean.novo()}"/>
                                <h:column>
                                    <p:commandButton value="Excluir" title="Excluir" onclick="PF('i_dlg_e').show()" disabled="#{vendasCaravanaBean.vendas.id == -1}"/>
                                </h:column>
                                <p:commandButton ajax="false" value="Pesquisar" title="Pesquisar" action="#{chamadaPaginaBean.pesquisaVendasCaravana()}"/>
                                <p:commandButton ajax="false" value="Imprimir Ficha de Reserva" title="Imprimir Ficha de Reserva" action="#{vendasCaravanaBean.imprimirFichaReserva()}" onclick="form.target = '_blank'" icon="ui-icon-print" disabled="#{vendasCaravanaBean.vendas.id == -1}"/>
                            </h:panelGrid>
                        </p:panel>                        
                        <p:dialog widgetVar="i_dlg_s" header="Deseja Salvar esta Venda" resizable="false" width="400" modal="true">
                            <h:panelGrid columns="2" id="i_panel_concluir_reserva" rendered="false">
                                <h:outputLabel value="Data da taxa:" rendered="#{vendasCaravanaBean.listaDataEntrada.size() > 0}"/>
                                <h:selectOneMenu value="#{vendasCaravanaBean.idDataEntrada}" rendered="#{vendasCaravanaBean.listaDataEntrada.size() > 0}">
                                    <f:selectItems value="#{vendasCaravanaBean.listaDataEntrada}" />
                                </h:selectOneMenu>
                                <h:outputLabel value="Mês da primeira mensalidade:" />
                                <h:selectOneMenu id="i_m_v" value="#{vendasCaravanaBean.idMesVencimento}">
                                    <f:selectItems value="#{vendasCaravanaBean.listaMesVencimento}" />
                                </h:selectOneMenu>                                 
                            </h:panelGrid>
                            <f:facet name="footer">
                                <h:panelGrid columns="2">
                                    <p:commandButton value="Salvar"   type="submit" styleClass="ui-confirmdialog-yes" action="#{vendasCaravanaBean.salvar()}" onclick="PF('i_dlg_s').hide()" icon="ui-icon-check" update="i_msg formVendasCaravana"/>
                                    <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" onclick="PF('i_dlg_s').hide()" icon="ui-icon-close"/>                                    
                                </h:panelGrid>
                            </f:facet>
                        </p:dialog>                        
                        <p:dialog widgetVar="i_dlg_e" header="Deseja Excluir esta Venda" resizable="false" width="400" modal="true">
                            <f:facet name="footer">
                                <h:panelGrid columns="2">
                                    <p:commandButton value="Excluir"   type="submit" styleClass="ui-confirmdialog-yes" action="#{vendasCaravanaBean.excluir()}" onclick="PF('i_dlg_e').hide()" icon="ui-icon-closethick" update="i_msg formVendasCaravana"/>
                                    <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no" onclick="PF('i_dlg_e').hide()" icon="ui-icon-close"/>
                                </h:panelGrid>
                            </f:facet>
                        </p:dialog>
                        <p:dialog id="id_alterar_dia_vencto"  widgetVar="dgl_alterar_dia_vencto" modal="true" header="Selecione o dia" resizable="false">
                            <h:panelGrid columns="2" id="i_alterar_dia_vencto">
                                <h:outputLabel value="Selecione a nova data:" />
                                <p:selectOneMenu id="cbDataVencimentoX" value="#{vendasCaravanaBean.idDiaVencimento}">
                                    <f:selectItems value="#{vendasCaravanaBean.listaDataVencimento}" />
                                </p:selectOneMenu>
                                <p:commandButton action="#{vendasCaravanaBean.updatePessoaComplemento}" update="i_msg formVendasCaravana" value="Alterar" oncomplete="PF('dgl_alterar_dia_vencto').hide()"/>
                            </h:panelGrid>
                        </p:dialog>                        
                    </h:form>                    
                    <p:dialog id="i_dialog" widgetVar="i_dlg_mapa" header="Mapa de Lugares" resizable="false" width="1000" modal="true" height="800">
                        <h:form id="formCaravanaOnibus">
                            <h:graphicImage url="/Cliente/#{controleUsuarioBean.clienteString}/Imagens/Mapas/mapa_onibus01.jpg" style="position: absolute; " width="250"/>
                        </h:form>
                    </p:dialog>
                </f:view>
                <!-- FINALIZA div wrap main -->
            </div>
        </div>
        <!-- FINALIZA div wrap main -->
        <div id="footerx">
            <f:subview id="footer">
                <ui:include src="templates/templateFooter.xhtml"/>
            </f:subview>
        </div>                
    </h:body>
</ui:composition>