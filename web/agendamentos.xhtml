<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>Agendamentos</title>
    </h:head>
    <h:body>
        <f:subview id="header">
            <ui:include src="templates/templatePrime.xhtml"/>
        </f:subview>
        <f:view>
            <p:panel style="margin: 0 auto; border: 0; width: #{configuracaoBean.resolucao.tipoResolucao.tamanho}">
                <h2 class="font-size-16">Agendamentos</h2>                
                <h:form id="form_person">
                    <h:outputScript name="tradutor_primefaces.js" library="js" />
                    <p:growl id="growl" showDetail="true"/> 
                    <p:messages showDetail="true" showSummary="true" autoUpdate="true"/> 
                    <c:set scope="request" var="object" value="${agendamentosBean.agendamento}"/>
                    <p:panel id="i_panel_person" rendered="#{agendamentosBean.pessoa.id eq -1}">
                        <f:facet name="header">
                            <h:panelGrid columns="2">
                                <p:column>
                                    <p:outputLabel value="FILIAIS: " styleClass="bold"/>
                                </p:column>
                                <p:column>
                                    <p:selectOneMenu  value="#{agendamentosBean.idFilial}" title="ADM. ACRESCENTAR FILIAL ROTINA E PERMISSÃO LIBERA ACESSO FILIAL" disabled="#{!agendamentosBean.liberaAcessaFilial or agendamentosBean.listFiliais.size() eq 1}">
                                        <p:ajax event="change" update="@this :form_person: :form_agendamentos: " listener="#{agendamentosBean.listener('filial')}"/>
                                        <f:selectItems value="#{agendamentosBean.listFiliais}" />
                                    </p:selectOneMenu>
                                </p:column>
                            </h:panelGrid>                            
                        </f:facet>
                        <h:panelGrid columns="5" cellspacing="5">
                            <p:commandButton action="#{chamadaPaginaBean.pesquisa('pesquisaPessoaFisica')}" value="Pesquisar Pessoa"/>
                            <p:commandButton action="#{fisicaGenericaBean.openModal()}" icon="ui-icon-search" styleClass="margin-left-max"/>
                        </h:panelGrid>            
                        <h:panelGrid columns="5" cellspacing="5">
                            <p:outputLabel value="CPF:" styleClass="bold"/>
                            <p:inputMask mask="999.999.999-99" value="#{agendamentosBean.pessoa.pessoa.documento}" size="15" styleClass="font-size-12 text-center bg-green-ligth">
                                <p:ajax event="change" update="@this :form_person: :form_agendamentos:" listener="#{agendamentosBean.findPessoaFisica}" />
                            </p:inputMask>
                        </h:panelGrid>
                    </p:panel>
                </h:form>                    
                <h:form id="form_agendamentos">
                    <h:panelGroup rendered="#{agendamentosBean.pessoa.id ne -1 and agendamentosBean.showModal}">
                        <h:panelGroup rendered="#{not empty agendamentosBean.pessoa.pessoa.pessoaComplemento.obsAviso}" >
                            <h:outputText value="#{genericaMensagem.getHtmlMessage('fatal', 'MENSAGEM DE BLOQUEIO', agendamentosBean.pessoa.pessoa.pessoaComplemento.obsAviso)}" escape="false" />
                            <br />
                        </h:panelGroup>
                        <p:panel styleClass="fundoCinza">
                            <h:panelGrid columns="3" style="width: 100%">
                                <h:column>
                                    <label class="bold font-size-12 font-color-blue"> #{agendamentosBean.pessoa.pessoa.nome} </label><label class="font-color-red">(#{agendamentosBean.pessoa.pessoa.socios.id eq -1 ? 'NÃO SÓCIO' : 'SÓCIO'})</label>
                                    <p:commandButton icon="ui-icon-contact" update=":form_agendamentos:i_pessoa_fisica_card" action="#{pessoaCardBean.cardFisica(agendamentosBean.pessoa.pessoa.id)}" oncomplete="PF('dlg_pessoa_fisica_card').show()" title="Ver detalhes" styleClass="margin-left-max"/>
                                </h:column>
                                <h:column rendered="#{agendamentosBean.pessoa.pessoa.socios.id ne -1}">
                                    <h:panelGrid columns="6">
                                        <h:column>Matrícula: #{agendamentosBean.pessoa.pessoa.socios.matriculaSocios.nrMatricula}</h:column>
                                        <h:column>Categoria: #{agendamentosBean.pessoa.pessoa.socios.matriculaSocios.categoria.categoria}</h:column>
                                        <h:column>Filiação: #{agendamentosBean.pessoa.pessoa.socios.parentesco.parentesco}</h:column>
                                    </h:panelGrid>
                                </h:column>
                                <h:column>
                                    <p:commandButton update=":form_person: :form_agendamentos:" action="#{genericaSessao.removeSession('agendamentosBean')}" value="NOVO AGENDAMENTO" style="float: right" styleClass="bold"/>
                                </h:column>
                            </h:panelGrid>
                        </p:panel>
                        <p:panel styleClass="margin-top-max">
                            <f:facet name="header">
                                <h:panelGrid columns="6" cellspacing="10">
                                    <h:outputLabel value="Grupo Convênio:" />
                                    <p:selectOneMenu value="#{agendamentosBean.idGrupoConvenio}">
                                        <p:ajax event="change" update="@this :form_agendamentos:" listener="#{agendamentosBean.listener('grupo_convenio')}" />
                                        <f:selectItems value="#{agendamentosBean.listGrupoConvenio}" />
                                    </p:selectOneMenu>
                                    <h:outputLabel value="Subgrupo Convênio:" />
                                    <p:selectOneMenu value="#{agendamentosBean.idSubGrupoConvenio}">
                                        <p:ajax event="change" update="@this :form_agendamentos:" listener="#{agendamentosBean.listener('subgrupo_convenio')}"  />
                                        <f:selectItems value="#{agendamentosBean.listSubGrupoConvenio}" />
                                    </p:selectOneMenu>
                                    <h:outputLabel value="Colaborador:" />
                                    <p:selectOneMenu value="#{agendamentosBean.idConvenio}">
                                        <p:ajax event="change" update="@this :form_agendamentos:" listener="#{agendamentosBean.listener('convenio')}"  />
                                        <f:selectItems value="#{agendamentosBean.listConvenio}" />
                                    </p:selectOneMenu>
                                </h:panelGrid>                                     
                            </f:facet>
                            <h:panelGrid columns="2"  style="width: 100%" columnClasses="verticalAlignTop,verticalAlignTop">
                                <h:column>
                                    <p:panel header="SERVIÇOS">
                                        <p:selectOneMenu value="#{agendamentosBean.idServico}" filter="true" filterMatchMode="contains"  style="width: 300px">
                                            <p:ajax event="change" update="@this :form_agendamentos:" listener="#{agendamentosBean.listener('servicos')}" />
                                            <f:selectItems value="#{agendamentosBean.listServicos}" />
                                        </p:selectOneMenu>                                        
                                    </p:panel>
                                </h:column>
                                <h:column>
                                    <p:panel header="ADICIONADOS">
                                        <p:dataTable emptyMessage="Nenhum serviço adicionado!">
                                            <p:column headerText="Serviço">

                                            </p:column>
                                            <p:column width="30">
                                                <p:commandButton icon="ui-icon-close" />
                                            </p:column>
                                        </p:dataTable>
                                    </p:panel>                                    
                                </h:column>                                                                
                            </h:panelGrid>     
                            <f:facet name="footer">
                                <h:panelGrid id="i_dates" columns="2">
                                    Data: 
                                    <p:calendar size="8" value="#{agendamentosBean.data}" pattern="dd/MM/yyyy" navigator="true" yearRange="c-1:c+1" mask="99/99/9999" locale="pt_BR" >
                                        <p:ajax event="dateSelect"  />
                                        <p:ajax event="change" />
                                    </p:calendar>                                            
                                </h:panelGrid>                                
                            </f:facet>
                        </p:panel>
                    </h:panelGroup>
                    <p:dialog widgetVar="dlg_pessoa_fisica_card" modal="true" resizable="false" height="400" width="400" header="Detalhes">
                        <p:ajax event="close" listener="#{pessoaCardBean.close}"/>  
                        <p:panel id="i_pessoa_fisica_card">
                            <ui:include src="templates/templatePessoaFisicaCard.xhtml" />
                        </p:panel>
                    </p:dialog> 
                </h:form>
                <ui:include src="templates/templateNovaPessoaFisica.xhtml"/>
            </p:panel>
        </f:view>
        <f:subview id="footer">
            <ui:include src="templates/templateFooter.xhtml"/>
        </f:subview>
    </h:body>
</ui:composition>