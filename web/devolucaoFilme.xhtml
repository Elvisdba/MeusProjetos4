<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Sindical - Devolução de Filmes</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <link rel="shortcut icon" href="#{facesContext.externalContext.requestContextPath}/Imagens/favicon.ico"/>  
        <style type="text/css">
            .ui-widget-content .ui-inputfield{ padding: 8px!important;} 
            .ui-button { padding: 3px!important; }
            .ui-datatable tr.ui-datatable-even:hover, .ui-datatable tr.ui-datatable-odd:hover {
                background: #ECF3FE;
            }            
        </style>
    </h:head>
    <h:body>
        <f:subview id="header">
            <ui:include src="templates/templatePrime.xhtml"/>
        </f:subview>
        <f:view>
            <ui:include src="templates/templateAcessoFilialComCaixa.xhtml" />
            <!-- INICIA DIV wrap e main -->
            <div id="wrapx">
                <div id="mainx">
                    <!-- INICIA DIV wrap e main -->  
                    <p:panel style="margin: 0 auto; border: 0; width: #{configuracaoBean.resolucao.tipoResolucao.tamanho}">
                        <h:outputText value="Devolução de Filmes" styleClass="fonteHeader" />
                        <div class="clear"></div>
                        <h:form id="form_locacao_filmes" onsubmit="return false;">
                            <c:set scope="request" var="object" value="${devolucaoFilmeBean.locadoraLote}"/>
                            <p:messages autoUpdate="true" showDetail="true" showSummary="true" />
                            <h:panelGrid id="id_msg_aviso_block" style="width: 100%" rendered="#{devolucaoFilmeBean.pessoaComplemento ne null}" >
                                <p:panel style="border: 1px solid #ff9999" styleClass="margin-top">
                                    <f:facet name="header">
                                        <h:outputLabel value="! MENSAGEM DE BLOQUEIO" style="font-weight: bold; color: red; "/>                                            
                                    </f:facet>
                                    <h:panelGrid columns="1">
                                        <h:column>
                                            <h:outputLabel value="#{devolucaoFilmeBean.pessoaComplemento.obsAviso}" style="color: black; font-weight: bold;"/>                                        
                                        </h:column>
                                    </h:panelGrid>
                                </p:panel>                                
                            </h:panelGrid>
                            <p:panel>
                                <f:facet name="header">
                                    <h:panelGrid columns="2">
                                        <p:outputLabel value="Data da devolução" />
                                        <p:inputMask maxlength="10" size="6" value="#{devolucaoFilmeBean.dataDevolucaoString}" readonly="readonly" mask="99/99/9999" converter="#{isDateString}">
                                            <p:ajax update="@this" event="change" />
                                        </p:inputMask>
                                    </h:panelGrid>
                                </f:facet>
                                <p:panel header="Locatário" id="i_panel_locatario">
                                    <h:panelGrid columns="2">
                                        <h:column>
                                            <h:panelGrid columns="4">
                                                <h:column>
                                                    <p:commandButton action="#{chamadaPaginaBean.pesquisa('pesquisaSocios')}" title="Pesquisar" icon="ui-icon-search" rendered="#{empty devolucaoFilmeBean.codigoLocatario}" actionListener="#{fisicaBean.listernerTipoPesquisa('socioativo')}"/>
                                                    <p:commandButton action="#{devolucaoFilmeBean.listener(1)}" title="Pesquisar" icon="ui-icon-search" rendered="#{not empty devolucaoFilmeBean.codigoLocatario}" update="i_panel_locatario"/>
                                                </h:column>
                                                <p:outputLabel value="#{devolucaoFilmeBean.locatario.pessoa.nome}" styleClass="bold" />
                                                <p:outputLabel value="( #{devolucaoFilmeBean.locatario.idade} anos )" styleClass="bold margin-left-max" rendered="#{devolucaoFilmeBean.locatario.id ne -1}"/>
                                            </h:panelGrid>
                                        </h:column>
                                    </h:panelGrid>
                                </p:panel>
                                <p:panel header="Filme(s)" styleClass="margin-top-max" id="i_panel_filme" rendered="#{devolucaoFilmeBean.locatario.id ne -1}">
                                    <h:panelGrid columns="2">
                                        <h:column>
                                            <h:panelGrid columns="3">
                                                <p:inputText size="5" maxlength="10" value="#{devolucaoFilmeBean.codigoBarras}" styleClass="font-size-14 input-text-med bg-yellow-ligth text-center"  placeholder="Código">
                                                    <p:ajax event="change" update="@this i_panel_filme" listener="#{devolucaoFilmeBean.listener(2)}" />
                                                </p:inputText>
                                                <h:column>
                                                    <p:commandButton action="#{chamadaPaginaBean.pesquisa('pesquisaTitulo', 'tituloBean')}" title="Pesquisar" icon="ui-icon-search" actionListener="#{devolucaoFilmeBean.listener(3)}" />
                                                </h:column>
                                            </h:panelGrid>
                                        </h:column>
                                        <h:panelGrid columns="3">
                                            <p:outputLabel value="#{devolucaoFilmeBean.titulo.descricao}" styleClass="bold" />
                                            <p:commandButton icon="ui-icon-info" onclick="PF('dlg_detalhes_filme').show();"  title="Detalhes" update=":form_locacao_filmes:i_detalhes_filme :form_locacao_filmes:i_detalhes_filme_t" styleClass="margin-left" rendered="#{devolucaoFilmeBean.titulo.id ne null}"/>
                                            <p:commandButton icon="ui-icon-close" action="#{devolucaoFilmeBean.listener(5)}"  title="Limpar" update=":form_locacao_filmes:" styleClass="margin-left-max" rendered="#{devolucaoFilmeBean.titulo.id ne null}"/>
                                        </h:panelGrid>
                                    </h:panelGrid>
                                    <f:facet name="footer">
                                        <p:commandButton value="Adicionar" action="#{devolucaoFilmeBean.add()}"  disabled="#{controleAcessoBean.botaoSalvar}" title="Detalhes sobre o filme" update=":form_locacao_filmes:" />
                                    </f:facet>
                                </p:panel>
                                <p:panel header="Filtrar" rendered="#{devolucaoFilmeBean.locatario.id ne -1}" styleClass="margin-top-max">
                                    <h:panelGrid id="i_history">
                                        <p:dataTable emptyMessage="Nenhum registro adicionado!" value="#{devolucaoFilmeBean.listLocadoraMovimento}" var="locadoraMovimento" rendered="# {not empty devolucaoFilmeBean.listLocadoraMovimento}">
                                            <p:column headerText="Locação" width="80">#{locadoraMovimento.locadoraLote.dataLocacaoString}</p:column>
                                            <p:column headerText="Previsão de entrega" width="80">#{locadoraMovimento.dataDevolucaoPrevisaoString}</p:column>
                                            <p:column headerText="Autorizado">#{locadoraMovimento.locadoraLote.locadoraAutorizados.nome}</p:column>
                                            <p:column headerText="Filme">#{locadoraMovimento.titulo.descricao}</p:column>
                                            <p:column headerText="Ano Lançamento" width="80" styleClass="text-center">#{locadoraMovimento.titulo.anoLancamento}</p:column>
                                            <p:column width="80" styleClass="text-center">#{locadoraMovimento.titulo.lancamento ? 'Lançamento' : ''}</p:column>
                                            <p:column styleClass="text-center" width="30">
                                                <p:commandButton icon="ui-icon-close" action="#{devolucaoFilmeBean.remove(locadoraMovimento)}" disabled="#{controleAcessoBean.botaoExcluir}" title="Excluir" update=":form_locacao_filmes:"/>                                            
                                            </p:column>
                                        </p:dataTable>
                                    </h:panelGrid>
                                </p:panel>
                            </p:panel>
                            <h:panelGrid columns="6" styleClass="margin-top-max">
                                <p:commandButton onclick="PF('dlg_save').show();" value="Concluir" disabled="#{controleAcessoBean.botaoSalvar or devolucaoFilmeBean.locatario.id eq -1}" title="Concluir locação"/>
                                <p:commandButton value="Novo" action="#{devolucaoFilmeBean.clear}" update=":form_locacao_filmes:"/>
                                <p:commandButton onclick="PF('dlg_delete').show();" value="Desfazer" disabled="#{controleAcessoBean.botaoExcluir}" title="Excluir" rendered="#{devolucaoFilmeBean.locadoraLote.id ne null}"/>
                                <p:commandButton onclick="PF('dlg_locacoes').show();" value="Histórico" title="Histórico" update="i_history_pending" rendered="#{devolucaoFilmeBean.locatario.id ne -1}"/>
                                <p:outputLabel value="Filmes pendentes para entrega (#{devolucaoFilmeBean.listLocadoraHistorico.size()})" rendered="#{devolucaoFilmeBean.locatario.id ne -1}"/>
                            </h:panelGrid>
                            <p:dialog widgetVar="dlg_save" header="Deseja concluir esta locação?" resizable="false" width="400" modal="true">
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Confirmar" type="submit" styleClass="ui-confirmdialog-yes" action="#{devolucaoFilmeBean.save()}" oncomplete="PF('dlg_save').hide();PF('dlg_message').show();" style="clear: both; float: left; margin-left: 10px;" update="i_message  :form_locacao_filmes:"/> 
                                        <p:commandButton value="Cancelar"  type="button" styleClass="ui-confirmdialog-no" onclick="PF('dlg_save').hide()" style="float: left;" icon="ui-icon-close"/>                                        
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_delete" header="Deseja desfazer esta locação?" resizable="false" width="400" modal="true">
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Confirmar" type="submit" styleClass="ui-confirmdialog-yes" action="#{devolucaoFilmeBean.delete()}" oncomplete="PF('dlg_delete').hide();PF('dlg_message').show();" style="clear: both; float: left; margin-left: 10px;" update="i_message :form_locacao_filmes:"/> 
                                        <p:commandButton value="Cancelar"  type="button" styleClass="ui-confirmdialog-no" onclick="PF('dlg_delete').hide()" style="float: left;" icon="ui-icon-close"/>                                    
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_locacoes" header="Pendências" resizable="false" width="1024" modal="true" positionType="fixed" position="top">
                                <p:ajax event="close" update=":form_locacao_filmes:" listener="#{devolucaoFilmeBean.listener(4)}"/>
                                <h:panelGrid cellpadding="5" columns="3">
                                    <p:commandButton value="Locados" title="Locados" update="i_history_pending" action="#{devolucaoFilmeBean.listener(4)}" style="color: blue"/>
                                    <p:commandButton value="Atrasados" title="Atrasados" update="i_history_pending" action="#{devolucaoFilmeBean.listener(6)}" styleClass="font-color-red"/>
                                    <p:commandButton value="Histórico" title="Histórico" update="i_history_pending" action="#{devolucaoFilmeBean.listener(7)}" style="color: #333300"/>
                                </h:panelGrid>
                                <h:panelGrid id="i_history_pending">
                                    <p:dataTable emptyMessage="Nenhum registro adicionado!" value="#{devolucaoFilmeBean.listLocadoraHistorico}" var="locadoraMovimento" scrollable="true" scrollHeight="200">
                                        <p:column headerText="Locação" width="80">#{locadoraMovimento.locadoraLote.dataLocacaoString}</p:column>
                                        <p:column headerText="Previsão de entrega" width="80">#{locadoraMovimento.dataDevolucaoPrevisaoString}</p:column>
                                        <p:column headerText="Autorizado">#{locadoraMovimento.locadoraLote.locadoraAutorizados.nome}</p:column>
                                        <p:column headerText="Filme">#{locadoraMovimento.titulo.descricao}</p:column>
                                        <p:column headerText="Ano Lançamento" width="80" styleClass="text-center">#{locadoraMovimento.titulo.anoLancamento}</p:column>
                                        <p:column width="80" styleClass="text-center">#{locadoraMovimento.titulo.lancamento ? 'Lançamento' : ''}</p:column>
                                    </p:dataTable>
                                </h:panelGrid>
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Sair" title="Sair" type="button" styleClass="ui-confirmdialog-no" onclick="PF('dlg_locacoes').hide()" icon="ui-icon-close" update=":form_locacao_filmes:" action="#{devolucaoFilmeBean.listener(4)}"/>
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_detalhes_filme" resizable="false" width="400" modal="true">
                                <f:facet name="header">
                                    <h:panelGrid id="i_detalhes_filme_t">
                                        #{devolucaoFilmeBean.titulo.descricao}                                        
                                    </h:panelGrid>
                                </f:facet>
                                <h:panelGrid columns="2" id="i_detalhes_filme">
                                    <p:column>Autor:</p:column>
                                    <p:column>#{devolucaoFilmeBean.titulo.autor}</p:column>
                                    <p:column>Atores:</p:column>
                                    <p:column>#{devolucaoFilmeBean.titulo.atores}</p:column>
                                    <p:column>Barras:</p:column>
                                    <p:column>#{devolucaoFilmeBean.titulo.barras}</p:column>
                                    <p:column>Ano:</p:column>
                                    <p:column>#{devolucaoFilmeBean.titulo.anoLancamento}</p:column>
                                    <p:column>Legenda:</p:column>
                                    <p:column>#{devolucaoFilmeBean.titulo.legenda}</p:column>
                                    <p:column>Faixa Etária:</p:column>
                                    <p:column>#{devolucaoFilmeBean.titulo.idadeMinimaString}</p:column>
                                    <p:column>Gênero:</p:column>
                                    <p:column>#{devolucaoFilmeBean.titulo.genero.descricao}</p:column>
                                </h:panelGrid>
                                <f:facet name="footer">
                                    <h:panelGrid>
                                        <p:commandButton value="Sair"  type="button" styleClass="ui-confirmdialog-no" onclick="PF('dlg_detalhes_filme').hide()" style="float: left;" icon="ui-icon-close"/>
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_message" header="Mensagem" resizable="false" width="400" modal="true" closable="true">
                                <p:messages autoUpdate="true" showDetail="true" showSummary="true" id="i_message" /> 
                                <f:facet name="footer">
                                    <h:panelGrid>
                                        <p:commandButton value="OK" type="submit" styleClass="ui-confirmdialog-yes" onclick="PF('dlg_message').hide();"/>                                        
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_validacao" header="Configurar Status!" resizable="false" width="400" modal="true" closable="false" visible="#{devolucaoFilmeBean.locadoraStatus eq null and segurancaUtilitariosBean.existeMacFilialComCaixa}">
                                <p:outputLabel value="Vá em: Menu Principal > Locadora > Cadastro > Status" />
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandLink value="Menu Principal" action="#{chamadaPaginaBean.menuPrincipal()}" title="Menu Principal" immediate="true"/>
                                        <p:commandLink value="Voltar" action="#{chamadaPaginaBean.back()}" title="Voltar" immediate="true" styleClass="margin-left-max"/>
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>
                        </h:form>
                    </p:panel>
                    <!-- FINALIZA div wrap main -->
                </div>
            </div>
            <!-- FINALIZA div wrap main -->              
        </f:view>
    </h:body>
</ui:composition>