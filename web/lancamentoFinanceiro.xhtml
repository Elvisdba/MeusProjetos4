<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions">

    <h:head>
        <title>Sindical - Lançamento Financeiro</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <link rel="shortcut icon" href="#{facesContext.externalContext.requestContextPath}/Imagens/favicon.ico"/>  
        <style type="text/css">
            .ui-widget-content .ui-inputfield{ padding: 8px!important;}
            .ui-button { padding: 3px!important; }
        </style>

        <script type="text/javascript">
            // BLOQUEIA ENTER
            // DESABILITA ENTER
            // DISABLED ENTERCentro Custo
            // VERIFICA SE OQ ESTOU DIGITANDO É STRING
            function stopRKey(evt) {
                var evt = (evt) ? evt : ((event) ? event : null);
                //var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null); 
                if (evt.keyCode === 13) {
                    return false;
                }
            }

            document.onkeypress = stopRKey;

        </script>
    </h:head>
    <h:body>
        <!-- INICIA DIV wrap e main -->
        <div id="wrapx">
            <div id="mainx">
                <ui:include src="templates/templateAcessoFilial.xhtml"/>
                <!-- INICIA DIV wrap e main -->  
                <f:subview id="header">
                    <ui:include src="templates/templatePrime.xhtml"/>
                    <ui:include src="templates/templateStatus.xhtml"/>
                </f:subview>
                <f:view>
                    <p:panel style="margin: 0 auto; border: 0; width: #{configuracaoBean.resolucao.tipoResolucao.tamanho}">
                        <h:outputText value="Lançamento Financeiro" styleClass="fonteHeader" />
                        <div class="clear"></div>
                        <h:form id="form_lf">    

                            <p:panel id="i_panel_lancamento" styleClass="fundoCinza">

                                <h:panelGrid id="i_panel_search" columns="5" style="width: 100%">
                                    <p:column>
                                        <p:commandButton value="Novo Lançamento" oncomplete="PF('i_dlg_novo').show()" action="#{lancamentoFinanceiroBean.abreModal}" update="i_dlg dlg_pedido" />
                                    </p:column>

                                    <p:column>
                                        <p:selectOneMenu value="#{lancamentoFinanceiroBean.porPesquisa}" style="width: 155px; margin-left: 60px">
                                            <p:ajax event="change" update="tbl i_pesquisa i_panel_search" listener="#{lancamentoFinanceiroBean.loadListaLancamento}"/>
                                            <f:selectItem itemLabel="Todos"           itemValue="todos"/>
                                            <f:selectItem itemLabel="Últimos 60 Dias" itemValue="dias"/>
                                            <f:selectItem itemLabel="Emissão"         itemValue="emissao"/>
                                            <f:selectItem itemLabel="Fornecedor"      itemValue="fornecedor"/>
                                            <f:selectItem itemLabel="Documento"       itemValue="documento"/>
                                            <!-- <f:selectItem itemLabel="Valor"           itemValue="valor"/> -->
                                        </p:selectOneMenu>
                                    </p:column>

                                    <p:column>
                                        <p:selectOneMenu value="#{lancamentoFinanceiroBean.idTipoDocumento}" style="padding-right: 20px;" rendered="#{lancamentoFinanceiroBean.porPesquisa == 'documento'}">
                                            <p:ajax event="change" update="i_panel_search"/>
                                            <f:selectItems value="#{lancamentoFinanceiroBean.listaTipoDocumento}" />
                                        </p:selectOneMenu>
                                    </p:column>

                                    <p:column>
                                        <p:inputMask id="i_pesquisa" style="margin-left: 20px" mask="#{lancamentoFinanceiroBean.maskSearch}" size="30" value="#{lancamentoFinanceiroBean.description}" 
                                                     rendered="#{(lancamentoFinanceiroBean.porPesquisa != 'dias' and lancamentoFinanceiroBean.porPesquisa != 'todos')}">
                                            <p:ajax event="change" update="@this tbl i_panel_search" listener="#{lancamentoFinanceiroBean.loadListaLancamento}"/>
                                        </p:inputMask>
                                        <p:watermark for="i_pesquisa" value="Digite sua Pesquisa"/>
                                    </p:column>

                                    <p:column>
                                        <h:outputLabel value="Estou visualizando"/>
                                        <p:commandLink value="#{lancamentoFinanceiroBean.strVisualizando}" onclick="PF('i_dlg_visualizar').show()" style="font-weight: bold; margin-left: 5px" update="i_visualizar_lancamentos"/>
                                    </p:column>
                                </h:panelGrid>
                            </p:panel>


                            <h:panelGroup id="tbl" layout="block">
                                <p:dataTable var="lote" value="#{lancamentoFinanceiroBean.listaLancamento}" emptyMessage="Nenhum Lançamento Emitido!">
                                    <p:column width="30" styleClass="text-center">
                                        <p:commandButton icon="ui-icon-pencil" title="Ver detalhes deste Lançamento" action="#{lancamentoFinanceiroBean.edit(lote)}" update=":form_lf:" oncomplete="PF('i_dlg_novo').show()" />
                                    </p:column>

                                    <p:column width="15">  
                                        <p:rowToggler />  
                                    </p:column> 

                                    <p:column headerText="Lançamento" width="90" styleClass="text-center">
                                        <h:outputLabel value="#{lote.lancamento}" title="Ver detalhes deste Lançamento" styleClass="bold"/>
                                    </p:column>

                                    <p:column headerText="Emissão" width="90" styleClass="text-center">
                                        <h:outputLabel  value="#{lote.emissao}" title="Ver detalhes deste Lançamento" styleClass="bold"/>
                                    </p:column>

                                    <p:column headerText="Documento" width="130" styleClass="text-center">
                                        <h:outputLabel  value="#{lote.documento}" title="Ver detalhes deste Lançamento" styleClass="bold"/>
                                    </p:column>

                                    <p:column headerText="Pessoa">
                                        <h:outputLabel  value="#{lote.pessoa.nome}" title="Ver detalhes deste Lançamento" styleClass="bold"/>
                                    </p:column>

                                    <p:column headerText="Valor (R$)"  width="80" styleClass="text-center">
                                        <h:outputLabel value="#{lote.valorString}" style="float: right"/>
                                    </p:column>


                                    <p:rowExpansion>
                                        <h:panelGrid columns="4" style="height: 40px" styleClass="sbb">
                                            <p:column>
                                                <h:panelGrid>
                                                    <h:outputText value="Nr Lote" styleClass="bold"/>
                                                    <h:outputLabel value="#{lote.id}"/>
                                                </h:panelGrid>
                                            </p:column>
                                            <p:column>
                                                <h:panelGrid>
                                                    <h:outputText value="Usuário" styleClass="bold"/>
                                                    <h:outputLabel value="#{lote.usuario.pessoa.nome}" />                                                
                                                </h:panelGrid>
                                            </p:column>
                                            <p:column>
                                                <h:panelGrid>
                                                    <h:outputText value="Filial" styleClass="bold"/>
                                                    <h:outputLabel value="#{lote.filial.filial.pessoa.nome}" />
                                                </h:panelGrid>
                                            </p:column>
                                        </h:panelGrid>
                                    </p:rowExpansion>
                                </p:dataTable>
                            </h:panelGroup>


                            <p:dialog modal="true" widgetVar="i_dlg_visualizar" header="Mudar Lista de Lançamento" width="300" height="300">
                                <h:panelGroup id="i_visualizar_lancamentos" layout="block">
                                    <h:panelGrid>
                                        <p:commandLink value="VER TODOS OS LANÇAMENTOS" action="#{lancamentoFinanceiroBean.alterarListaLancamento(usuario)}" update=":form_lf:i_panel_search :form_lf:tbl" oncomplete="PF('i_dlg_visualizar').hide()" style="font-weight: bold; margin-bottom: 10px"/>
                                    </h:panelGrid>

                                    <h:panelGrid>
                                        <p:dataList value="#{lancamentoFinanceiroBean.listaUsuarioLancamento}" var="usuario" type="definition"  style="height: 100px; border: 10px">
                                            <p:commandLink value="#{segurancaUtilitariosBean.sessaoUsuario.id == usuario.id ? 'MEUS LANÇAMENTOS' : usuario.pessoa.nome}" action="#{lancamentoFinanceiroBean.alterarListaLancamento(usuario)}" update=":form_lf:i_panel_search :form_lf:tbl" oncomplete="PF('i_dlg_visualizar').hide()"/><br /><br />
                                        </p:dataList>  
                                    </h:panelGrid>
                                </h:panelGroup>
                            </p:dialog>                            

                            <p:dialog id="i_dlg" widgetVar="i_dlg_novo" header="Lançamento" resizable="false" modal="true" width="950" height="500" minHeight="600" visible="#{lancamentoFinanceiroBean.modalVisivel}" responsive="true" draggable="false" closeOnEscape="true" maximizable="true">
                                <p:ajax event="close" listener="#{lancamentoFinanceiroBean.fechaModal()}" update=":form_lf:"/>  
                                <h:panelGroup layout="block" id="i_validations">
                                    <h:outputText value="#{genericaMensagem.getHtmlMessage('error', 'CADATRAR CONTAS')}" escape="false" rendered="#{lancamentoFinanceiroBean.idContaOperacao eq 0}" />
                                </h:panelGroup>
                                <p:panel styleClass="fundoCinza">
                                    <h:panelGrid>
                                        <h:outputText value="Filial" />
                                        <p:selectOneMenu value="#{lancamentoFinanceiroBean.idFilial}" style="width: 800px">
                                            <p:ajax event="change" update="@this i_grupo i_para_conta i_valor i_msg i_validations i_actions" listener="#{lancamentoFinanceiroBean.atualizaComboOperacao()}"/>
                                            <f:selectItems value="#{lancamentoFinanceiroBean.listaFilial}"/>
                                        </p:selectOneMenu>                                        
                                    </h:panelGrid>                                        
                                </p:panel>
                                <h:panelGroup id="i_tipo" layout="block">
                                    <h:panelGrid columns="7" styleClass="margin-top-max">
                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Perfil" />
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.es}" style="width: 70px">
                                                    <p:ajax event="change" update="i_tipo i_grupo i_para_conta i_valor i_msg i_validations i_actions i_chk_produtos" listener="#{lancamentoFinanceiroBean.atualizaComboES()}" global="false"/>
                                                    <f:selectItem itemValue="E" itemLabel="Entrada"/>
                                                    <f:selectItem itemValue="S" itemLabel="Saida"/>
                                                </p:selectOneMenu>           
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                            <h:panelGrid id="i_es_lanc">
                                                <h:outputText value="Perfil do Lançamento" />
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.esLancamento}" style="width: 70px">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                    <f:selectItem itemValue="E" itemLabel="Entrada"/>
                                                    <f:selectItem itemValue="S" itemLabel="Saida"/>
                                                </p:selectOneMenu>                                                
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Lançamento" />
                                                <p:inputMask value="#{lancamentoFinanceiroBean.lote.lancamento}" mask="99/99/9999" size="8" readonly="true">
                                                    <p:ajax event="change" update="@this" global="false" />
                                                </p:inputMask>
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Emissão" />
                                                <p:inputMask value="#{lancamentoFinanceiroBean.lote.emissao}" mask="99/99/9999" size="8" converter="#{isDateString}">
                                                    <p:ajax event="change" update="@this" global="false" />
                                                </p:inputMask>
                                            </h:panelGrid>
                                        </h:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <h:outputText value="Condição"/>
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.condicao}" disabled="#{lancamentoFinanceiroBean.lote.id != -1 and not empty lancamentoFinanceiroBean.listaParcela}">
                                                    <p:ajax event="change" update="@this i_vencimento" global="false" listener="#{lancamentoFinanceiroBean.loadVencimento}"/>
                                                    <f:selectItem itemValue="vista" itemLabel="A Vista"/>
                                                    <f:selectItem itemValue="prazo" itemLabel="A Prazo"/>
                                                </p:selectOneMenu>                                                
                                            </h:panelGrid>
                                        </p:column>                                        

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Número Doc." />
                                                <p:inputText value="#{lancamentoFinanceiroBean.lote.documento}" style="width: 125px">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                </p:inputText>                                                
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Tipo" />
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.idFTipo}" style="width: 100px">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                    <f:selectItems value="#{lancamentoFinanceiroBean.listaFTipo}"/>
                                                </p:selectOneMenu>                                                
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                        </h:column>                                        

                                    </h:panelGrid>
                                    <h:panelGrid columns="7">
                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Operação" styleClass="font-color-red bold" />
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.idOperacao}">
                                                    <p:ajax event="change" update="i_grupo i_para_conta i_valor i_validations i_actions i_chk_produtos" listener="#{lancamentoFinanceiroBean.atualizaComboOperacao()}" global="false"/>
                                                    <f:selectItems value="#{lancamentoFinanceiroBean.listaOperacao}"/>
                                                </p:selectOneMenu>
                                            </h:panelGrid>
                                        </h:column>

                                        <p:column>
                                            <h:panelGroup layout="block" id="i_grupo">
                                                <h:panelGrid columns="3">
                                                    <h:column>
                                                        <h:panelGrid>
                                                            <h:outputText value="Centro Custo" styleClass="font-color-red bold"/>
                                                            <p:selectOneMenu value="#{lancamentoFinanceiroBean.idCentroCusto}"  disabled="#{lancamentoFinanceiroBean.idCentroCusto eq 0}">
                                                                <p:ajax event="change" update="i_grupo i_para_conta i_valor i_validations i_actions i_chk_produtos" listener="#{lancamentoFinanceiroBean.atualizaComboCentroCusto()}"/>
                                                                <f:selectItems value="#{lancamentoFinanceiroBean.listaCentroCusto}"/>
                                                            </p:selectOneMenu>
                                                        </h:panelGrid>
                                                    </h:column>
                                                    <h:column>
                                                        <h:panelGrid>
                                                            <h:outputText value="Conta" styleClass="font-color-red bold"/>
                                                            <p:selectOneMenu value="#{lancamentoFinanceiroBean.idContaOperacao}" disabled="#{lancamentoFinanceiroBean.idContaOperacao eq 0}" filter="true" filterMatchMode="startsWith">
                                                                <p:ajax event="change" update="@this i_para_conta i_valor i_chk_produtos" />
                                                                <f:selectItems value="#{lancamentoFinanceiroBean.listaContaOperacao}"/>
                                                            </p:selectOneMenu>
                                                        </h:panelGrid>
                                                    </h:column>
                                                    <h:column>
                                                        <h:panelGroup id="i_chk_produtos" layout="block">
                                                            <p:selectBooleanCheckbox value="#{lancamentoFinanceiroBean.produtos}" rendered="#{lancamentoFinanceiroBean.plano.id != -1}" itemLabel="Produto">
                                                                <p:ajax event="change" update="@this i_valor" />
                                                            </p:selectBooleanCheckbox>
                                                        </h:panelGroup>
                                                    </h:column>
                                                </h:panelGrid>
                                            </h:panelGroup>
                                        </p:column>

                                    </h:panelGrid>
                                </h:panelGroup>                                
                                <hr />
                                <h:panelGroup layout="block">
                                    <p:panel header="Credor/Devedor">
                                        <h:panelGrid columns="3" id="i_panel_cadastro" >
                                            <p:column>
                                                <h:panelGrid columns="2">
                                                    <h:column>
                                                        <p:commandButton action="#{chamadaPaginaBean.pesquisa('pesquisaPessoaFisica')}" icon="ui-icon-search" rendered="#{lancamentoFinanceiroBean.idTipoDocumento == 1 and lancamentoFinanceiroBean.pessoa.id == -1}"/>
                                                        <p:commandButton action="#{chamadaPaginaBean.pesquisa('pesquisaPessoaJuridica')}" icon="ui-icon-search" rendered="#{lancamentoFinanceiroBean.idTipoDocumento == 2 and lancamentoFinanceiroBean.pessoa.id == -1}"/>
                                                        <p:commandButton action="#{chamadaPaginaBean.pesquisa('pesquisaPessoa')}" icon="ui-icon-search" rendered="#{lancamentoFinanceiroBean.idTipoDocumento == 4 and lancamentoFinanceiroBean.pessoa.id == -1}" />
                                                    </h:column>
                                                    <p:selectOneMenu value="#{lancamentoFinanceiroBean.idTipoDocumento}" disabled="#{lancamentoFinanceiroBean.pessoa.id != -1}">
                                                        <p:ajax event="change" listener="#{lancamentoFinanceiroBean.cancelarCadastro()}" update="i_panel_cadastro i_panel_pessoa" global="false"/>
                                                        <f:selectItems value="#{lancamentoFinanceiroBean.listaTipoDocumento}" />
                                                    </p:selectOneMenu>
                                                </h:panelGrid>
                                            </p:column>

                                            <p:column>
                                                <p:inputMask id="i_documento" value="#{lancamentoFinanceiroBean.descricao}" size="20" mask="#{lancamentoFinanceiroBean.mascara}" readonly="#{lancamentoFinanceiroBean.pessoa.id != -1}" styleClass="text-center" disabled="#{lancamentoFinanceiroBean.idTipoDocumento == 4}" >
                                                    <p:ajax event="change" listener="#{lancamentoFinanceiroBean.pesquisarPessoa()}" update="i_panel_pessoa i_panel_cadastro" />
                                                </p:inputMask>

                                                <p:watermark value="Documento" for="i_documento" />
                                            </p:column>

                                            <p:column>
                                                <p:commandLink value="Não encontrou na pesquisa? Cadastre uma nova pessoa aqui" style="margin-left: 20px" rendered="#{lancamentoFinanceiroBean.pessoa.id == -1}">
                                                    <p:ajax event="click" listener="#{lancamentoFinanceiroBean.cadastrarPessoa('')}" update="i_panel_pessoa i_msg " />
                                                </p:commandLink>
                                            </p:column>
                                        </h:panelGrid>
                                        <h:panelGrid id="i_panel_pessoa" columns="2">
                                            <h:column rendered="#{lancamentoFinanceiroBean.pessoa.id != -1}">
                                                <h:panelGrid columns="3">
                                                    <h:outputText value="Nome:" style="font-weight: bold"/>
                                                    <h:outputText value="#{lancamentoFinanceiroBean.pessoa.nome}"/>

                                                    <p:commandLink value="Limpar tudo e começar de Novo" action="#{lancamentoFinanceiroBean.limpar()}" update="form_lf" style="margin-left: 150px" />
                                                </h:panelGrid>
                                            </h:column>

                                            <h:column rendered="#{lancamentoFinanceiroBean.opcaoCadastro != '' and lancamentoFinanceiroBean.opcaoCadastro == 'juridica'}">
                                                <h:panelGrid columns="3">
                                                    <h:outputText value="Cadastro de Empresa" style="font-weight: bold"/>
                                                    <p:commandLink ajax="false" value="Ir para cadastro completo" action="#{chamadaPaginaBean.pessoaJuridica()}" style="margin-left: 20px"/>
                                                    <p:commandLink ajax="true" value="Quero cadastrar uma PESSOA FÍSICA" action="#{lancamentoFinanceiroBean.cadastrarPessoa('fisica')}" update="i_panel_pessoa" rendered="#{lancamentoFinanceiroBean.idTipoDocumento == 2}" style="margin-left: 50px"/>
                                                </h:panelGrid><br />
                                                <h:panelGrid columns="4">
                                                    <p:inputText id="i_nome_empresa" value="#{lancamentoFinanceiroBean.pessoa.nome}" style="margin-right: 15px;" size="50">
                                                        <p:ajax event="change" update="@this" />
                                                    </p:inputText>
                                                    <p:watermark value="Nome da Empresa" for="i_nome_empresa"/>
                                                    <p:commandButton value="Salvar" action="#{lancamentoFinanceiroBean.salvarPessoa}" update="i_panel_pessoa i_panel_cadastro i_msg" />
                                                    <p:commandButton action="#{lancamentoFinanceiroBean.cancelarCadastro()}" update="i_panel_pessoa i_panel_cadastro" icon="ui-icon-close" />  
                                                </h:panelGrid>
                                            </h:column>

                                            <h:column rendered="#{lancamentoFinanceiroBean.opcaoCadastro != '' and lancamentoFinanceiroBean.opcaoCadastro == 'fisica'}">
                                                <h:panelGrid columns="3">
                                                    <h:outputText value="Cadastro de Pessoa Física" style="font-weight: bold"/>
                                                    <p:commandLink ajax="false" value="Ir para cadastro completo" action="#{chamadaPaginaBean.pessoaFisica()}" style="margin-left: 20px"/>
                                                    <p:commandLink ajax="true" value="Quero cadastrar uma PESSOA JURÍDICA" action="#{lancamentoFinanceiroBean.cadastrarPessoa('juridica')}" update="i_panel_pessoa" rendered="#{lancamentoFinanceiroBean.idTipoDocumento == 2}" style="margin-left: 50px"/>
                                                </h:panelGrid><br />
                                                <h:panelGrid columns="4">
                                                    <p:inputText id="i_nome_fisica" value="#{lancamentoFinanceiroBean.pessoa.nome}" style="margin-right: 15px;" size="50">
                                                        <p:ajax event="change" update="@this" />
                                                    </p:inputText>
                                                    <p:watermark value="Nome da Pessoa" for="i_nome_fisica"/>
                                                    <p:commandButton value="Salvar" action="#{lancamentoFinanceiroBean.salvarPessoa}" update="i_panel_pessoa i_panel_cadastro i_msg" />
                                                    <p:commandButton action="#{lancamentoFinanceiroBean.cancelarCadastro()}" update="i_panel_pessoa i_panel_cadastro" icon="ui-icon-close" />  
                                                </h:panelGrid>
                                            </h:column>
                                        </h:panelGrid>
                                    </p:panel>
                                </h:panelGroup>

                                <p:messages id="i_msg" showDetail="true" closable="true"/>  


                                <p:panel styleClass="fundoCinza margin-top-max">
                                    <f:facet name="header">
                                        <h:panelGrid id="i_para_conta" columns="3">
                                            <h:outputLabel value="Lançamento para Conta " />
                                            <h:outputLabel value="#{lancamentoFinanceiroBean.strConta}" style="font-weight: bold"/>

                                            <p:selectBooleanCheckbox value="#{lancamentoFinanceiroBean.chkImposto}" itemLabel="Imposto" onchange="">
                                                <p:ajax event="change" update="i_dlg_conta i_para_conta i_vencimento" onsuccess="PF('i_dlg_conta').show()" listener="#{lancamentoFinanceiroBean.listaPlano5.clear()}"/>
                                            </p:selectBooleanCheckbox>
                                        </h:panelGrid>
                                    </f:facet>
                                    <h:panelGrid id="i_valor" columns="9">
                                        <p:column>
                                            <h:panelGrid>
                                                <h:outputText value="Total" style="font-weight: bold"/>
                                                <h:column>
                                                    <h:column rendered="#{lancamentoFinanceiroBean.plano.id == -1}">
                                                        <p:inputText value="#{lancamentoFinanceiroBean.total}" size="8" style="text-align: right" converter="#{toCurrency}">
                                                            <p:ajax event="change" update="@this" global="false"/>
                                                        </p:inputText>
                                                    </h:column>
                                                    <h:column rendered="#{lancamentoFinanceiroBean.plano.id != -1}">
                                                        <p:inputText value="#{lancamentoFinanceiroBean.total}" size="8" style="text-align: right" converter="#{toCurrency}" rendered="#{!lancamentoFinanceiroBean.produtos}">
                                                            <p:ajax event="change" update="@this" global="false"/>
                                                        </p:inputText>                                                        
                                                        <p:commandButton value="R$ #{lancamentoFinanceiroBean.total}" action="#{lancamentoFinanceiroBean.openModalPedido()}" oncomplete="PF('dlg_pedido').show();" style="font-weight: bold" update=":form_lf:dlg_pedido" rendered="#{lancamentoFinanceiroBean.produtos}"/>
                                                    </h:column>
                                                </h:column>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid id="i_vencimento">
                                                <h:outputText value="Vencimento" style="font-weight: bold"/>
                                                <p:inputMask value="#{lancamentoFinanceiroBean.vencimento}" mask="99/99/9999" size="8" converter="#{isDateString}" styleClass="text-center" readonly="#{lancamentoFinanceiroBean.condicao eq 'vista' and lancamentoFinanceiroBean.listaParcela.size() eq 1 and !lancamentoFinanceiroBean.chkImposto}">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                </p:inputMask>
                                            </h:panelGrid>
                                        </p:column>

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputLabel value="Número Doc." />
                                                <p:inputText value="#{lancamentoFinanceiroBean.documentoMovimento}" size="10">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                </p:inputText>
                                            </h:panelGrid>
                                        </h:column>

                                        <h:column>
                                            <h:panelGrid>
                                                <h:outputText value="Tipo Documento" />
                                                <p:selectOneMenu value="#{lancamentoFinanceiroBean.idFTipoMovimento}" style="width: 130px">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                    <f:selectItems value="#{lancamentoFinanceiroBean.listaFTipoMovimento}"/>
                                                </p:selectOneMenu>
                                            </h:panelGrid>
                                        </h:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <h:outputText value=" Acréscimo"/>
                                                <p:commandButton value="#{lancamentoFinanceiroBean.acrescimo}" action="#{lancamentoFinanceiroBean.openModalAcrescimo()}" update=":form_lf:i_panel_acrescimo" oncomplete="PF('i_dlg_acrescimo').show()"/>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <h:outputText value="Desconto" />
                                                <p:inputText value="#{lancamentoFinanceiroBean.desconto}" size="7" style="text-align: right" converter="#{toCurrency}">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                </p:inputText>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <h:outputText value="Valor" style="font-weight: bold"/>
                                                <p:inputText value="#{lancamentoFinanceiroBean.valor}" size="8" style="text-align: right" converter="#{toCurrency}">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                </p:inputText>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <h:column>
                                                    <br />
                                                </h:column>
                                                <p:commandButton title="Adicionar" icon="ui-icon-plus" action="#{lancamentoFinanceiroBean.adicionarParcela()}" update="i_valor tbl_p i_msg i_para_conta :form_lf:i_panel_acrescimo"/>
                                            </h:panelGrid>
                                        </p:column>
                                    </h:panelGrid>

                                    <p:inputTextarea id="i_historico" style="width: 100%;" rows="2" maxlength="2000" value="#{lancamentoFinanceiroBean.historico}" placeholder="Digite o Histórico" autoResize="true">

                                    </p:inputTextarea>
                                </p:panel>

                                <p:dataTable var="parcela" id="tbl_p" value="#{lancamentoFinanceiroBean.listaParcela}" selection="#{lancamentoFinanceiroBean.listaParcelaSelecionada}" rowKey="#{parcela.parcela}" rowIndexVar="index" emptyMessage="Adicionar Parcela!" scrollable="true" scrollHeight="110" editable="#{lancamentoFinanceiroBean.lote.id == -1}" editMode="cell" styleClass="margin-top-max">
                                    <p:column selectionMode="multiple" width="15" styleClass="text-center" />
                                    <p:column width="15">  
                                        <p:rowToggler />  
                                    </p:column>

                                    <p:column width="15">
                                        <p:commandButton action="#{lancamentoFinanceiroBean.openExcluirParcela(parcela, index)}" oncomplete="PF('i_dlg_ex_movimento').show()" title="Excluir Movimento" icon="ui-icon-close" style="width: 20px; height: 20px" disabled="#{not empty parcela.dataQuitacao}"/>
                                    </p:column>

                                    <p:column headerText="Vencto" styleClass="text-center">
                                        <h:outputLabel value="#{parcela.vencimento}" />
                                    </p:column>

                                    <p:column headerText="Referência" styleClass="text-center">
                                        <p:inputMask mask="99/9999" value="#{parcela.referencia}" placeholder="__/____" converter="#{isDateReference}" size="8" styleClass="text-center" readonly="#{not empty parcela.dataQuitacao}">
                                            <p:ajax event="change" update="@this" />
                                        </p:inputMask>
                                    </p:column>

                                    <p:column headerText="Valor" styleClass="text-right">
                                        <h:outputLabel value="R$ #{parcela.valor}" style="font-weight: bold"/>
                                    </p:column>

                                    <p:column headerText="Acréscimo">
                                        <h:outputText value="R$ "/>
                                        <p:commandLink value="#{parcela.acrescimo}" style="float: right; font-size: 10pt!important; font-weight: bold" oncomplete="PF('i_dlg_acrescimo').show()" rendered="#{lancamentoFinanceiroBean.lote.id == -1}">
                                            <p:ajax event="click" update=":form_lf:i_panel_acrescimo" listener="#{lancamentoFinanceiroBean.alterarAcrescimo(index)}" />
                                        </p:commandLink>
                                        <h:outputLabel value="#{parcela.acrescimo}" style="float: right;" rendered="#{lancamentoFinanceiroBean.lote.id != -1}"/>
                                    </p:column>

                                    <p:column headerText="Desconto">
                                        <p:cellEditor>  
                                            <f:facet name="output">
                                                <h:outputText value="R$ "/>
                                                <h:outputText value="#{parcela.desconto}" style="float: right"/>
                                            </f:facet>  
                                            <f:facet name="input">
                                                <p:inputText value="#{parcela.desconto}" style="width:96%" label="Desconto">
                                                    <p:ajax event="change" update="tbl_p" listener="#{lancamentoFinanceiroBean.alterarDesconto(index)}" global="false"/>
                                                </p:inputText>
                                            </f:facet>  
                                        </p:cellEditor>  
                                    </p:column>


                                    <p:column headerText="Vl Pagto">
                                        <h:outputText value="R$ "/>
                                        <h:outputText value="#{parcela.valorQuitado}" style="float: right"/>
                                    </p:column>

                                    <p:column headerText="Data Pagto" styleClass="text-center">
                                        <h:outputText value="#{parcela.dataQuitacao}"/>
                                    </p:column>


                                    <p:rowExpansion>
                                        <h:panelGrid columns="4" style="height: 40px" styleClass="sbb">
                                            <p:column>
                                                <h:outputText value="Conta" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.movimento.plano5.conta}" />
                                            </p:column>

                                            <p:column>
                                                <h:outputText value="Lote Baixa" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.loteBaixa}" />
                                            </p:column>

                                            <p:column>
                                                <h:outputText value="Usuário" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.usuarioNome}" />
                                            </p:column>

                                            <p:column>
                                                <h:outputText value="Caixa" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.caixa}" />
                                            </p:column>
                                        </h:panelGrid>
                                        <h:panelGrid columns="4" style="height: 40px" styleClass="sbb">
                                            <p:column>
                                                <h:outputText value="Tipo de Documento" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.movimento.tipoDocumento.descricao}" />
                                            </p:column>

                                            <p:column>
                                                <h:outputText value="Documento" style="font-weight: bold"/><br />
                                                <h:outputLabel value="#{parcela.movimento.documento}" />
                                            </p:column>                                            
                                        </h:panelGrid>
                                    </p:rowExpansion>
                                </p:dataTable>
                                <br />
                                <f:facet name="footer">
                                    <h:panelGrid columns="8" id="i_actions">
                                        <p:commandButton value="Salvar" onclick="PF('i_dlg_salvar').show()" title="Salvar este Lançamento" disabled="#{lancamentoFinanceiroBean.idContaOperacao eq 0}"/>
                                        <p:commandButton value="Novo" action="#{lancamentoFinanceiroBean.limpar()}" update="form_lf" title="Limpar tudo e começar de Novo" />
                                        <p:commandButton ajax="false" value="Baixar" action="#{lancamentoFinanceiroBean.telaBaixa()}" update="tbl_p" rendered="#{lancamentoFinanceiroBean.lote.id != -1}" title="Baixar este Lançamento" />
                                        <p:commandButton value="Estornar" onclick="PF('i_dlg_estornar').show()" rendered="#{lancamentoFinanceiroBean.lote.id != -1}" title="Estornar este Lançamento" />
                                        <p:commandButton value="Excluir este Lançamento" onclick="PF('i_dlg_ex_lancamento').show()" rendered="#{lancamentoFinanceiroBean.lote.id != -1}" title="Excluir este Lançamento" />
                                        <p:commandButton value="Fechar esta Janela" action="#{lancamentoFinanceiroBean.fechaModal()}" onclick="PF('i_dlg_novo').hide();" update=":form_lf:"/>
                                    </h:panelGrid>

                                </f:facet>
                            </p:dialog>

                            <p:dialog id="i_dlg_conta" widgetVar="i_dlg_conta" header="Conta Obrigação" modal="true" resizable="false" width="600" height="70" visible="#{lancamentoFinanceiroBean.chkImposto}" closable="false" draggable="false">
                                <h:panelGrid>
                                    <h:outputText value="Conta" styleClass="bold"/>
                                    <p:selectOneMenu value="#{lancamentoFinanceiroBean.idPlano5}">
                                        <p:ajax event="change" update="@this" />
                                        <f:selectItems value="#{lancamentoFinanceiroBean.listaPlano5}"/>
                                    </p:selectOneMenu>                                                
                                </h:panelGrid>
                                <f:facet name="footer">
                                    <h:panelGrid>
                                        <p:commandButton value="OK" update="i_para_conta i_valor" onclick="PF('i_dlg_conta').hide()" />                                            
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>                            

                            <p:dialog id="dlg_pedido" widgetVar="dlg_pedido" width="800" resizable="false" modal="true" visible="#{lancamentoFinanceiroBean.modalPedido}" header="Itens da nota">
                                <p:ajax event="close" listener="#{lancamentoFinanceiroBean.closeModalPedido()}" update="@this i_valor"/>
                                <h:panelGrid id="i_grid_pedido">
                                    <!-- TELA CADASTRO -->
                                    <p:messages autoUpdate="true" showSummary="true" showDetail="true" id="i_message_pedido"/>
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Pesquisar" icon="ui-icon-search" title="Pesquisar Produto" action="#{chamadaPaginaBean.pesquisaProduto()}" actionListener="#{genericaSessao.putString('type', 'all')}"/>
                                        <p:outputLabel value="#{lancamentoFinanceiroBean.pedido.produto.descricao} #{lancamentoFinanceiroBean.pedido.produto.marca} #{lancamentoFinanceiroBean.pedido.produto.medida} (#{lancamentoFinanceiroBean.pedido.produto.produtoUnidade.descricao})" />
                                    </h:panelGrid>

                                    <h:panelGrid columns="4">
                                        <p:column>
                                            <h:panelGrid>
                                                <p:outputLabel value="Quantidade" />
                                                <p:inputText value="#{lancamentoFinanceiroBean.quantidadePedidoString}" size="5" style="margin-right: 15px" converter="#{thisNumber}">
                                                    <p:ajax event="change" update="@this" />
                                                </p:inputText>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <p:outputLabel value="Valor Unitário" />
                                                <p:inputText value="#{lancamentoFinanceiroBean.valorUnitarioPedido}" size="8" style="margin-right: 15px" converter="#{toCurrency4}" styleClass="text-right">
                                                    <p:ajax event="change" update="@this" />
                                                </p:inputText>
                                            </h:panelGrid>
                                        </p:column>

                                        <p:column>
                                            <h:panelGrid>
                                                <p:outputLabel value="Desconto Unitário" />
                                                <p:inputText value="#{lancamentoFinanceiroBean.descontoUnitarioPedido}" size="12" converter="#{toCurrency}" styleClass="text-right">
                                                    <p:ajax event="change" update="@this" />
                                                </p:inputText>
                                            </h:panelGrid>
                                        </p:column>    

                                        <p:column>    
                                            <h:panelGrid>
                                                <h:column>
                                                    <br />                                                    
                                                </h:column>
                                                <p:commandButton value="Adicionar" icon="ui-icon-plus" action="#{lancamentoFinanceiroBean.addItemPedido()}" update="i_grid_pedido i_message_pedido"/>
                                            </h:panelGrid>
                                        </p:column>    
                                    </h:panelGrid>

                                    <!-- // TELA CADASTRO -->

                                    <!-- TELA LISTA PEDIDOS -->

                                    <p:dataTable value="#{lancamentoFinanceiroBean.listaPedidos}" style="width: 770px" var="pedido" scrollable="true" scrollHeight="150" emptyMessage="Nenhum registro encontrado!" rowIndexVar="index" >
                                        <!-- <p:column styleClass="text-center" style="width: 10px">
                                            <p:commandButton icon="ui-icon-link" action="# {lancamentoFinanceiroBean.editarItemPedido(index)}" update=":form_lf:i_grid_pedido" title="Editar registro"/>
                                        </p:column> -->
                                        <p:column headerText="Produto" style="width: 100px">
                                            #{pedido.produto.descricao}
                                        </p:column>
                                        <p:column headerText="Qnt" styleClass="text-center" style="width: 20px">
                                            #{pedido.quantidade}
                                        </p:column>
                                        <p:column headerText="Valor Unitário" style="text-align: right; width: 80px">
                                            #{pedido.valorUnitarioString}
                                        </p:column>
                                        <p:column headerText="Desconto" style="text-align: right; width: 80px">
                                            #{pedido.descontoUnitarioString}
                                        </p:column>                                
                                        <p:column headerText="Valor Total" style="text-align: right; width: 80px">
                                            <h:outputText value="#{lancamentoFinanceiroBean.valorTotalGrid(pedido)}" />
                                        </p:column>                                
                                        <p:column styleClass="text-center" style="width: 15px">
                                            <p:commandButton icon="ui-icon-trash" action="#{lancamentoFinanceiroBean.removeItemPedido(index)}" update=":form_lf:dlg_pedido" title="Remover registro"/>
                                        </p:column>
                                        <f:facet name="footer">                                    
                                            Valor Total: #{lancamentoFinanceiroBean.valorTotal}
                                        </f:facet>
                                    </p:dataTable>

                                    <!-- TELA LISTA PEDIDOS -->

                                    <!-- AÇÕES -->
                                    <f:facet name="footer">
                                        <h:panelGrid columns="4">
                                            <h:column rendered="#{lancamentoFinanceiroBean.lote.id == -1}">
                                                <p:commandButton value="Novo" action="#{lancamentoFinanceiroBean.novoPedido()}" update="dlg_pedido" />
                                            </h:column>

                                            <p:commandButton value="Concluir" action="#{lancamentoFinanceiroBean.closeModalPedido()}" onclick="PF('dlg_pedido').hide();"/>
                                        </h:panelGrid>
                                    </f:facet>

                                    <!-- // AÇÕES -->
                                </h:panelGrid>

                            </p:dialog>                             

                            <p:dialog widgetVar="i_dlg_salvar" header="Deseja realmente SALVAR este lançamento?" resizable="false" modal="true">
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Sim" onclick="PF('i_dlg_salvar').hide()" action="#{lancamentoFinanceiroBean.save}" update="form_lf" title="Salvar este Lançamento" icon="ui-icon-check"/>  
                                        <p:commandButton value="Não" onclick="PF('i_dlg_salvar').hide()" icon="ui-icon-close"/>  
                                    </h:panelGrid>                                    
                                </f:facet>
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_estornar" header="Deseja realmente ESTORNAR este lançamento?" resizable="false" modal="true">
                                <h:panelGrid>
                                    <p:outputLabel value="Motivo" />
                                    <p:inputTextarea value="#{lancamentoFinanceiroBean.motivoEstorno}" cols="70" rows="2" placeholder="Digite um motivo para o Estorno"/>
                                </h:panelGrid>
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Sim" onclick="PF('i_dlg_estornar').hide()" action="#{lancamentoFinanceiroBean.reverse()}" update="tbl_p i_msg" title="Estornar este Lançamento" icon="ui-icon-check"/>  
                                        <p:commandButton value="Não" onclick="PF('i_dlg_estornar').hide()" icon="ui-icon-close"/>                                          
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_ex_lancamento" header="Deseja EXCLUIR DEFINITIVAMENTE este lançamento?" resizable="false" modal="true">
                                <h:outputLabel value="(Atenção) Após a exclusão este lançamento não poderá ser retornado!" style="font-size: 10pt!important; color: red"/>
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Sim" onclick="PF('i_dlg_ex_lancamento').hide()" action="#{lancamentoFinanceiroBean.delete()}" update="form_lf"  title="Excluir este Lançamento" icon="ui-icon-check"/>  
                                        <p:commandButton value="Não" onclick="PF('i_dlg_ex_lancamento').hide()" icon="ui-icon-close"/>  
                                    </h:panelGrid>                                    
                                </f:facet>
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_ex_movimento" header="Excluir esta linha do Lançamento" resizable="false" modal="true">
                                <h:outputLabel value="Deseja EXCLUIR este Movimento?" />
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Sim" onclick="PF('i_dlg_ex_movimento').hide()" action="#{lancamentoFinanceiroBean.excluirParcela()}" update="form_lf"  title="Excluir este Lançamento" icon="ui-icon-check"/>  
                                        <p:commandButton value="Não" onclick="PF('i_dlg_ex_movimento').hide()" icon="ui-icon-close"/>  
                                    </h:panelGrid>                                    
                                </f:facet>
                            </p:dialog>

                            <p:dialog widgetVar="i_dlg_acrescimo" header="Lançar Acréscimo" resizable="false" modal="true" draggable="false">
                                <h:panelGrid id="i_panel_acrescimo" columns="3">
                                    <p:column>
                                        <h:panelGrid>
                                            <h:outputText value="Multa" />
                                            <p:inputText value="#{lancamentoFinanceiroBean.multa}" size="8" styleClass="text-right" converter="#{toCurrency}">
                                                <p:ajax event="change" update="@this" global="false"/>
                                            </p:inputText>                                            
                                        </h:panelGrid>
                                    </p:column>
                                    <p:column>
                                        <h:panelGrid>
                                            <h:outputText value="Juros" />
                                            <p:inputText value="#{lancamentoFinanceiroBean.juros}" size="8" styleClass="text-right" converter="#{toCurrency}">
                                                <p:ajax event="change" update="@this" global="false"/>
                                            </p:inputText>
                                        </h:panelGrid>
                                    </p:column>
                                    <p:column>
                                        <h:panelGrid>
                                            <h:outputText value="Correção" />
                                            <p:inputText value="#{lancamentoFinanceiroBean.correcao}" size="8" styleClass="text-right" converter="#{toCurrency}">
                                                <p:ajax event="change" update="@this" global="false"/>
                                            </p:inputText>
                                        </h:panelGrid>
                                    </p:column>
                                </h:panelGrid>

                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Adicionar" onclick="PF('i_dlg_acrescimo').hide()" action="#{lancamentoFinanceiroBean.adicionarAcrescimo()}" update="form_lf"  title="Excluir este Lançamento" icon="ui-icon-check"/>  
                                        <p:commandButton value="Cancelar" onclick="PF('i_dlg_acrescimo').hide()" icon="ui-icon-close"/>  
                                    </h:panelGrid>                                    
                                </f:facet>
                            </p:dialog>
                        </h:form>
                    </p:panel>
                </f:view>
                <!-- FINALIZA div wrap main -->
            </div>
        </div>
        <!-- FINALIZA div wrap main -->

        <div id="footerx">
            <f:subview id="footer">
                <ui:include src="templates/templateFooter.xhtml"/>
            </f:subview>
        </div>                
    </h:body>
</ui:composition>